# 测试体系建设总结

> STAR: 场景, 任务, 行动, 结果

哆啦A梦: 基于RobotFramework深度定制的接口自动化测试体系.

- 开箱即用: 专注测试工作
- IDE驱动: 以VSCode为核心, 打通测试工作环境
- 持续完善的生态: 接口自动化, 压测套件, 造数平台, 能效助手 


## 主要流程

### 项目创建和测试用例编写

1. 在vscode中安装doramon的主插件: `souche doraemon`, 其中包含了6个扩展包

安装完成后, 会得到一些插件, 这些插件包含了一些系列的体系功能. 

2. 在主插件中**任意门**一栏选择创建项目, 随后插件就会帮助你创建一个空的项目, 在这个过程中, 插件会检查你的python环境和相关的python依赖, 然后进行依赖的同步工作. 

```
.
├── .venv (python虚拟环境，拥有独立的依赖)
│
├── config
│   ├── dev.env.yaml  (存放 测试环境 变量)
│   ├── prepub.env.yaml  (存放 预发环境 变量)
│   ├── prod.env.yaml  (存放 线上环境 变量)
│   ├── doraemon.yaml  (远程配置)
│   └── doraemon_local.yaml  (本地配置，优先级高于doraemon.yaml，不会被推送到远程Git)
│
├── data-service (造数脚本存放目录)
│
├── locust (压测脚本存放目录)
│
├── tests (接口自动化脚本存放目录)
│   ├── api
│   │   └── xxx.robot (接口声明)
│   ├── keywords
│   │   └── xxx.robot (通用关键字)
│   └── suites
│       └── xxx.robot (测试用例)
│ 
└── requirements.txt (存放python库的依赖)
```


3. 从抓包工具中获取想要测试的接口, 然后通过工具创建文件, 就能创建对应接口的`api`文件和`keywords`文件. 
4. 然后在suite中出创建测试用例, 开始编写测试文件.
5. 编写完成后点击运行按钮, 执行对应的测试脚本

到此为止, 一个基础的可以创建测试用例的项目就完成了. 

### 流水线相关操作

相关插件: `竹蜻蜓`

通过竹蜻蜓插件, 可以创建流水线, 进行一定的持续集成的能力. 他允许你远程执行某些Case, 并产生报告单到钉钉的群中, 它适用于: 

- 定时执行自动化脚本, 并发送报告
- 适用于开发同学提测之前, 执行该功能对应的脚本, 卡提测流程

竹蜻蜓中有两种任务:

1. 手动指定的远程任务, 可以通过配置分支, 用例, 执行环境, 钉钉相关配置, 成功失败回调等参数调用远程的流水线
2. 同样通过参数去配置一些定时指定的流水线, 采用`cron`配置定时信息

当然也可以删除对应的流水线信息

### 脚本的共享

相关插件: `次元口袋`

1. 在创建项目的时候可以选择创建module项目
2. 会生成与测试项目类似的项目工程文件夹

```
.
├── config (和Doraemon项目一致)
│
├── keywords
│   ├── index.robot (该文件的Keywords（包括Resource/Library的其他文件内的Keywords）会被暴露出去)
│   └── util.py
│ 
├── icon.png (在Module商店显示的图标)
│ 
├── module.yaml (Module的名称、描述、版本号在这里管理)
│
├── README.md (在Module商店显示的主页)
│ 
└── requirements.txt (存放python库的依赖)
```

3. 然后通过主插件的任意门模块, 可以上传当前的module, 注意需要在`module.yaml`中手动的修改`version`.
4. 之后, 在模块商店就可以看到你上传的插件了, 之后通过点击模块下载, 会导入到你当前的项目中的`modules`文件夹中. 通过智能提示插件, 可以联想模块的关键字并且进行自动的包的导入.

### Mock

在创建API之前, 会选择是否需要创建mock, 如果点了是, 就会在创建接口文件的时候帮你创建一个mock文件, 里面是一个json的数据. 

只需要在`doraemon_local`中填写对应的`mock`文件的路径, 就可以调用对应的mock数据了. 只有的脚本中所有该接口的请求都会返回你填写的内容. mock文件不要上传到远程服务器. 

## 其他功能

- App打包助手
- 造数平台
- 压测套件
- 能效小工具: jira提示助手


