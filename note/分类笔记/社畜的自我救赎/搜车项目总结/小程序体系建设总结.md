# 小程序体系建设总结

> STAR: 场景, 任务, 行动, 结果

## 场景

投放小程序需要在多个小程序平台投放营销页面和留资页面, 场景单一, 重复性高. 

原有的小程序项目代码, 业务冗杂, 技术陈旧. 项目代码分散且处于无人维护的状态

## 任务

从零开始构建完善的小程序跨段体系结构, 能够快速的应用在当前的投放小程序需求上

## 行动

1. 调研和选型

充分的调研市面上的小程序跨端框架, 从:

- 易用性
- 更新速度
- 流行程度
- 稳定性
- 技术契合度

等多个方面选择框架, 最终确定`taro3.x`是当时最适合我们的小程序跨端框架. 

2. 合作规划和技术架构设计

整合两个部门的前端资源和设计资源, 进行一期的体系开发. 

一期的体系开发内容包含:

- 小程序项目脚手架的开发(封装taro官方脚手架): 整合开发流程, 能够快速的创建基于我们小程序体系的小程序项目
- 项目模板的配置与开发: 整合一些常用的配置, 整合组件库和工具包, 默认使用ts进行项目开发
- 组件库的开发(重点): 双组件库并行开发
- 工具包的开发: 路由库的开发, 组件库的开发, 以及埋点库的开发

3. 推进, 迭代和落地

对于这方面, 主要做了一下几个方面的工作:

- 每隔两周进行任务进度的汇报和节点确认, 会后进行总结并推送内部进度邮件
- 在集团内部寻求落地机会, 积极进行技术体系的宣传
- 积极的接入集团的devops平台, 将技术体系集成到集团的前端工程化流水线中

4. 反馈和更新

- 积极的对反馈的bug进行更新和迭代
- 对二期开发进行规划(还在进行中), 具体的内容包含:
  - 小程序自动化测试体系的建立
  - 本部门常见的业务模组的抽离
  - 建设比较完善的组件迭代节奏

## 技术细节

### 1. 网络库的作用是什么, 主要封装了什么能力?

网络库的封装主要的功能如下:

- 提供实例化开发模式, 比如设定一个基准的URL
- 提供可选的搜车约定格式的数据返回形式
- 提供请求的前置钩子和后置钩子, 提供高自定义的数据转换形式
- 封装可选的错误提示内容
- 配置默认的请求参数, 错误提示持续时间等

### 2. 路由库中主要做了什么

- 建立路由守卫, 包含前置路由守卫, 需要在守卫中调用next才能进行跳转

### 3. 埋点库做了什么

- 初始化当前平台的埋点信息
- 提供一些发送前的钩子函数和回调函数
- 在vue版本中提供指令形式的调用, 并且封装了一些修饰符
- 可以通过全局API直接发送埋点

### 4. 组件库是如何设计的, 大概有哪些组件

组件库分为6大块不同类型的组件, 主要按组件的职责进行划分:

- 基础组件: Button, Fab, Image, Icon等
- 布局组件: 负责布局显示, 比如list, popup等
- 视图组件: 类似头像, tag, 步骤条之类视觉显示的组件
- 表单组件: input, switch之类用于表单输入的组件
- 反馈组件 toast, dialog 等提示框组件
- 导航组件: 包含navBar, tabBar, tabs等导航类的组件

2. 后续的更新计划和迭代的计划有吗? 

后续的迭代主要分这么几块内容:

- 组件的迭代和扩展, 比如城市选择器, 车辆选择器, 门店选择器以及复杂筛选页面的扩展组件
- 进行业务库的适配, 比如ab模块, mock的解决方案, vscode插件的开发等等
- 测试生态的改善, 开发环境切换工具, 抓包工具等等
- 探索原生端的结合方案