# 重构原则

## 何为重构

"重构"这个词视不同的上下文有两种不同的定义. 

作为名词:

> 重构: 对软件内部接口的一种调整, 目的是在不改变软件可观察行为的前提下, 提高其可理解性, 降低其修改成本.

一般而言, 重构都是对软件的小改动, 但重构之中还可以包含另一个重构. 

作为动词:

>　重构：　使用系列重构手法，在不改变软件可观察行为的前提下，调整其接口.

### 两项帽子

- 添加新功能
- 重构

## 为何重构

- 改进软件设计
- 使软件更容易理解
- 帮助找到bug
- 提高编程速度

## 何时重构

首先重构应该随时随地的进行, 并且不应该为了重构而重构, 而是为了想要做什么东西, 重构可以帮助你吧那些事情做好. 

### 三次法则

Don Roberts: 第一次做某件事只管去做, 第二次会产生反感, 第三次再做类似的事, 就应当重构.

> 事不过三, 三则重构

### 重构的几种场景

1. 添加功能时重构
2. 修复错误时重构
3. 审查代码时重构

### 间接层和重构

> 计算机科学是这样一门科学: 它相信所有问题都可以通过增加一个间接层来解决. --Dennis DeBruler

间接层的作用:

1. 允许逻辑共享
2. 分开解释意图和实现
3. 隔离变化
4. 封装条件逻辑

但是过多的间接层也会影响代码的可读性. 

### 重构的难题

1. 对于数据库的重构
   - 在非对象数据库中, 可以通过在对象模型和数据库模型之间插入一个分隔层来隔离两个模型各自的变化
   - 耨写对象数据库提供了不同版本的对象之间的自动迁移功能. 如果没有, 就必须手动进行数据迁移.
2. 对于接口的重构
   - 尽量保留旧接口来调用新街口
   - 不要过早的发布接口
3. 难以通过重构手法完成的设计改动
   - 先想象重构的情况.
  
### 何时不该重构

- 重写
- 项目已经接近最后期限
